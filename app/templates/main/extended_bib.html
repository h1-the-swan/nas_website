{% extends "base.html" %}

{% block custom_head_tags %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
<link rel="stylesheet" href="{{ url_for('static', filename='styles/dashboard.css') }}" type="text/css" media="screen" charset="utf-8">
<style type="text/css" media="screen">
	#extendedBibTable {
		font-size: .7rem;
	}
</style>
{% endblock custom_head_tags %}

{% block content %}	
{# <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow"> #}
	{# <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Company name</a> #}
	{# <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search"> #}
	{# <ul class="navbar-nav px-3"> #}
		{# <li class="nav-item text-nowrap"> #}
			{# 	<a class="nav-link" href="#">Sign out</a> #}
			{# </li> #}
		{# </ul> #}
	{# </nav> #}

<div class="container-fluid">
	<div class="row">
		<nav class="col-md-2 d-none d-md-block bg-light sidebar">
			<div class="sidebar-sticky">
				<ul class="nav flex-column">
					<li class="nav-item">
						<a class="nav-link" href="{{ url_for('main.index') }}">
							<span data-feather="home"></span>
							Home
						</a>
					</li>
					{% for project in projects %}

					{% if this_project['url'] == project['url'] %}
					<li class="nav-item">
						<a class="nav-link active" href="{{ project['url'] }}">
							{{ project['name'] }} <span class="sr-only">(current)</span>
						</a>
					</li>

					{% else %}
					<li class="nav-item">
						<a class="nav-link" href="{{ project['url'] }}">
							{{ project['name'] }}
						</a>
					</li>

					{% endif %}
					{% endfor %}
			</div>
		</nav>

		<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
		<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
			<h1 class="h2">{% block title %}Extended Bibliography{% endblock %}</h1>
			<div class="btn-group">
				<button type="button" class="btn btn-primary dropdown-toggle mr-md-5" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Download Data
				</button>
				<div class="dropdown-menu">
					{% for fname in download_fnames %}
					<a class="dropdown-item" href="{{ fname['fname'] }}">{{ fname['desc'] }}</a>
					{% endfor %}
				</div>
				
			</div>

		</div>
		<p>
			{{ this_project.get('description') }}
		</p>
		<table id="extendedBibTable"></table>

		<div class="vis-methods mt-5">
			{% block vis_methods %}
			{% if this_project.get('methods') %}
					{% call collapsible(extra_classes='') %}
					{{ this_project['methods']|safe }}
					{% endcall %}
				
			{% endif %}
				
			{% endblock vis_methods %}
		</div>


		</main>
	</div>
</div>
{% endblock content %}

{% block endbody_tags %}
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@4.6.3/papaparse.min.js" integrity="sha256-1KCNEBmmUm8Oo4IOlg7ZnbFjBZXxCa9bILP7eGDqYOY=" crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
<script type="text/javascript" charset="utf-8">
	var data_fname = "{{ data_fname }}"
var columnsToShow = [
	'rank',
	'Paper_ID',
	'issn',
	'isbn',
	'doi',
	'pub_date',
	'title',
	'title_source',
	'title_source_abbrev',
	'subject_traditional',
	'heading',
	'subheading',
	'pub_type',
	// 'keyword',
];

var data = Papa.parse(data_fname, {
	download: true,
	delimiter: "\t",
	header: true,
	skipEmptyLines: true,
	complete: function(results) {
		console.log(results);
		var columnConf = [],
			fields = results.meta.fields;
		for (var i = 0, len = fields.length; i < len; i++) {
			if (columnsToShow.includes(fields[i])) {
				var thisColumnVisible = true;
			} else {
				var thisColumnVisible = false;
			}
			columnConf.push({ title: fields[i], data: fields[i], visible: thisColumnVisible });
		}
		$('#extendedBibTable').DataTable( {
			data: results.data,
			pageLength: 10,
			columns: columnConf
		} );
	}
});
</script>
{% endblock endbody_tags %}
